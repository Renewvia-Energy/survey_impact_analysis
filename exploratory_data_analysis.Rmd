---
title: "Renewvia - Survey Impact Analysis"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

# Importing the libraries and datsets

```{r}
# tinytex::install_tinytex()
library(dataMaid) 
library(ggplot2)
library(dplyr)
library(lessR)
library(tidyr)
library(ggpubr)
library(exact2x2)
```

```{r}
# Loading the paired data
initial_clean <- read.csv("data_cleaning/datasets_clean/initial_clean.csv")
initial_enc <- read.csv("data_cleaning/datasets_encoded/initial_encoded.csv")
# makeDataReport(initial_clean,
#                output = "html",
#                replace = TRUE)
# create_report(df)
# ExpReport(df, op_file = 'SmartEDA_df.html')
```

```{r}
hs_post_clean <- read.csv("data_cleaning/datasets_clean/hs_post_clean.csv")
hs_post_enc <- read.csv("data_cleaning/datasets_encoded/hs_post_encoded.csv")
# makeDataReport(hs_post_clean,
#                output = "html",
#                replace = TRUE)
```

```{r}
ci_post_clean <- read.csv("data_cleaning/datasets_clean/ci_post_clean.csv")
ci_post_enc <- read.csv("data_cleaning/datasets_encoded/ci_post_encoded.csv")
# makeDataReport(ci_post_clean,
#                output = "html",
#                replace = TRUE)
```

```{r}
initial_clean_id <- initial_clean %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")
hs_post_clean_id <- hs_post_clean %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")
ci_post_clean_id <- ci_post_clean %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")

clean_paired <- merge(initial_clean_id, hs_post_clean_id, 
                      suffix = c("_pre", "_post"),
                      by= 'renewvia_id')
```

```{r}
initial_enc_id <- initial_enc %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")
hs_post_enc_id <- hs_post_enc %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")
ci_post_enc_id <- ci_post_enc %>% 
                    filter(renewvia_id != "") %>% 
                    filter(renewvia_id != "no_meter")
enc_paired <- merge(initial_enc_id, hs_post_enc_id, 
                    suffix = c("_pre", "_post"),
                    by= 'renewvia_id')

household_paired <- enc_paired %>% filter(tariff_pre == "residential")
```

# 1- GENDER EQUALITY

**Data set**: Household Post-Connection Survey

**Statistical Test**: Pearson's Chi-Square Goodness of fit

**Hypothesis Testing**:

-   $H_{0}$: No changes in girls' school enrollment; $H_{1}$: A change in girls' school enrollment

-   $H_{0}$: No changes in boys' school enrollment; $H_{1}$: A change in boys' school enrollment

#### Question 1-a: Has there been a change in the number of females in your household who attend school full time since connection to mini-grid power?

```{r}
# Breakdown of observed change
data_test <- hs_post_clean_id %>% filter(girls_schooling_change != "") 
data_test$girls_schooling_change <- factor(data_test$girls_schooling_change)
PieChart(girls_schooling_change, hole = 0, values = "%",
         data = data_test,
         main = "")

# 
# girls_enrolled <- factor(hs_post_enc$girls_schooling_change)
# girls_enrolled_table <-table(girls_enrolled)
# chisq.test(girls_enrolled_table,p=rep(1/3,3))
```

#### Question 1-b: Has there been a change in the number of males in your household who attend school FULL TIME since connection to mini-grid power?

```{r}
# Breakdown of observed change
PieChart(boys_schooling_change, hole = 0, values = "%", 
         data = hs_post_clean_id,
         main = "")


boys_enrolled <- factor(hs_post_enc$boys_schooling_change)
boys_enrolled_table <-table(boys_enrolled)
chisq.test(boys_enrolled_table,p=rep(1/3,3))
```

#### Question 1-c: If you answered yes to adding new workers, how many new employees are female?

**Data set**: Commercial Post-Connection Survey

**Statistical Test**: One-sample t-Test

**Hypothesis Testing**: $H_{0}$: No changes in number of women employed by local businesses; $H_{1}$: A change in number of women employed by local businesses

```{r}
women_employees = ci_post_enc$workforce_change_female
hist(women_employees)
```

```{r}
# One-sample t-Test
t.test(women_employees, mu = 0,alternative = "greater")
```

#### Question 1-d: Are any female household members business owners?

**Data set**: Household Paired Survey

**Statistical Test**: Paired Proportion McNemar's Chi-squared test

**Hypothesis Testing**: $H_{0}$: No changes in the proportion of women business owners; $H_{1}$: A change in the proportion of women business owners

```{r}
business_women_matrix <- c(nrow(enc_paired %>% 
                                  filter(business_owners_female_pre == 0 &
                                           business_owners_female_post == 0)),
                           nrow(enc_paired %>% 
                                  filter(business_owners_female_pre == 0 &
                                           business_owners_female_post == 1)),
                           nrow(enc_paired %>% 
                                  filter(business_owners_female_pre == 1 &
                                           business_owners_female_post == 0)),
                           nrow(enc_paired %>% 
                                  filter(business_owners_female_pre == 1 &
                                           business_owners_female_post == 1))
)
Performance <-
    matrix(business_women_matrix,
           nrow = 2,
           dimnames = list("1st Survey" = c("No", "Yes"),
               "2nd Survey" = c("No", "Yes")))

Performance
```

```{r}
# Approximation test
mcnemar.test(Performance)
## Exact test
mcnemar.exact(Performance)
```

# 2- PRODUCTIVITY

#### Question 2-a: How many hours of light per day do you currently have at home?

**Data set**: Household Paired Survey

**Statistical Test**: Two-sample Paired t-Test

**Hypothesis Testing**: $H_{0}$: No change in the average light hours for household; $H_{1}$: A change in the average income for household

```{r}

# commercial <- enc_paired %>% filter(tariff_pre == "commercial")

# For household
hs_light_hours_pre <- household$light_hours_current_pre
hist(hs_light_hours_pre)
hs_light_hours_post <- household$light_hours_current_post
hist(hs_light_hours_post)
t.test(hs_light_hours_pre, hs_light_hours_post, 
       paired = TRUE, alternative = "two.sided")

# For Commercial
# ci_light_hours_pre <- commercial$light_hours_current_pre
# ci_light_hours_post <- commercial$light_hours_current_post
# t.test(light_hours_pre, light_hours_post, 
#        paired = TRUE, alternative = "two.sided")
```

#### Question 2-b: Since connection to Renewvia mini-grid, have your hours of operation changed at all?

**Data set**: Commercial Post Survey

**Statistical Test**: Pearson's Chi-squared Goodness of fit test

**Hypothesis Testing**: $H_{0}$: No change in business operation hours; $H_{1}$: A change in business operation hours

```{r}
# Breakdown of observed change in school enrollment of girls
PieChart(operations_hours_change, hole = 0, values = "%", 
         data = ci_post_enc,
         main = "")


operation_hours <- factor(ci_post_enc$operations_hours_change)
operation_hours_table <-table(operation_hours)
chisq.test(operation_hours_table,p=rep(1/3,3))
```

#### Question 2-c: Since connection to Renewvia mini-grid, what appliances have you added to your business operations?

**Data set**: Commercial Post Survey

**Statistical Test**: One sample t-Test

**Hypothesis Testing**: $H_{0}$: No change in number of appliances added to local business; $H_{1}$: A change in number of appliances added to local business

```{r}
# No of appliances
new_business_appliances <- ci_post_enc$appliances_addition_count

# One-sample t-Test
t.test(new_business_appliances, mu = 0,alternative = "greater")
```

#### Question 2-c: Since connection to Renewvia mini-grid, what appliances have you added to your business operations?

**Data set**: Commercial (Schools) Post Survey

**Statistical Test**: Pearon's Chi-Squared Test

**Hypothesis Testing**: $H_{0}$: No change in number of appliances added to local business; $H_{1}$: A change in number of appliances added to local business

```{r}
# Breakdown of observed change in school enrollment of girls
PieChart(school_performance, hole = 0, values = "%",
         data = ci_post_clean,
         main = "")


school_performance <- factor(ci_post_enc$school_performance)
school_performance_table <-table(school_performance)
chisq.test(school_performance_table,p=rep(1/2,2))
```

**TO-DO**

-   Has school performance changed since connection to mini-grid?

-   Have you seen a change in overall school performance?

-   How many cell phones does your household have?

-   How far must you travel to obtain your water supply?

-   How long does the water collection process take on a daily basis?

-   How long does the cooking fuel collection process take on a daily basis?

-   Time spent traveling to charge phones

-   How often do you need to charge your mobile phone?

-   How far must you travel to charge your mobile phone?

-   If you answered "yes, they have increased" above, by how many hours have they increased?

# 3- HEALTH

#### Question 3-a: Do you feel that you have better access to health services because of connection to mini-grid?

**Data set**: Household Post Survey

**Statistical Test**: Pearson's Chi-Squared Test

**Hypothesis Testing**: $H_{0}$: No change in access to better healthcare; $H_{1}$: A change in access to better healthcare

```{r}
# Breakdown of observed change
hs_post_clean_id <- hs_post_clean_id %>% filter(
                                                better_access_health_minigrid != ""
                                              )
PieChart(better_access_health_minigrid, hole = 0, values = "%",
         data = hs_post_clean_id,
         main = "")


better_health <- factor(hs_post_clean_id$better_access_health_minigrid)
better_health_table <-table(better_health)
chisq.test(better_health_table,p=rep(1/2, 2))

```

#### Question 3-B: Do you have a source for clean drinking water?

**Data set**: Household Paired Survey

**Statistical Test**: McNemar's Chi-Squared Test

**Hypothesis Testing**: $H_{0}$: No change in access to better healthcare; $H_{1}$: A change in access to better healthcare

```{r}
clean_water_matrix <- c(nrow(enc_paired %>% 
                                  filter(clean_drinking_water_pre == 0 &
                                           clean_drinking_water_post == 0)),
                           nrow(enc_paired %>% 
                                  filter(clean_drinking_water_pre == 0 &
                                           clean_drinking_water_post == 1)),
                           nrow(enc_paired %>% 
                                  filter(clean_drinking_water_pre == 1 &
                                           clean_drinking_water_post == 0)),
                           nrow(enc_paired %>% 
                                  filter(clean_drinking_water_pre == 1 &
                                           clean_drinking_water_post == 1))
)
Performance <-
    matrix(clean_water_matrix,
           nrow = 2,
           dimnames = list("1st Survey" = c("No", "Yes"),
               "2nd Survey" = c("No", "Yes")))

Performance

```

```{r}
# Approximation test
mcnemar.test(Performance)
## Exact test
mcnemar.exact(Performance)
```

-   What hours is the Health Center / Clinic open?

-   For clinics or health services only: Since connection to Renewvia minigrid, have your health service offerings changed in any of the following ways: (select all that apply).

-   Does your Health Center / Clinic have access to refrigeration?

-   Does your Health Center have access to minigrid electricity?

-   What is the source for clean drinking water?

-   How many kerosene lamps do you currently use in your household?

-   Has the number of kerosene lamps in your household changed since connection to minigrid?

-   Approximately how many hours a day do you use kerosene lamps?

-   Do you feel that you have better access to health services because of connection to mini-grid?

# 4- SAFETY

#### Question 4-a: How safe do you feel outside your home when it is dark?

**Data set**: Household Paired Survey

**Statistical Test**: Paired t-Test

**Hypothesis Testing**: $H_{0}$: No change in feeling safe; $H_{1}$: A change in feeling safe

```{r}
# household <- enc_paired %>% filter(tariff_pre == "residential")
# commercial <- enc_paired %>% filter(tariff_pre == "commercial")

# For household
hs_feel_safe_pre <- household$feel_safe_dark_pre
hist(hs_feel_safe_pre)
hs_feel_safe_post <- household$feel_safe_dark_post
hist(hs_feel_safe_post)
t.test(hs_feel_safe_pre, hs_feel_safe_post,  
       paired = TRUE, alternative = "two.sided")

# For Commercial
# ci_light_hours_pre <- commercial$light_hours_current_pre
# ci_light_hours_post <- commercial$light_hours_current_post
# t.test(light_hours_pre, light_hours_post, 
#        paired = TRUE, alternative = "two.sided")
```

**TO-DO**

-   What makes you feel the most unsafe?

-   Does your community currently have outdoor community lights?

-   How safe would you feel outside your home at nighttime IF you had exterior lights?

# 5- ECONOMIC ACTIVITY

#### Question 5-a: What is your average monthly household income?

**Data set**: Household Paired Survey

**Statistical Test**: Paired t-Test, setting mean to 3 as neutral

**Hypothesis Testing**: $H_{0}$: No change in average household income; $H_{1}$: A change in average household income

```{r}
# household <- enc_paired %>% filter(tariff_pre == "residential")
# commercial <- enc_paired %>% filter(tariff_pre == "commercial")

# For household
avg_household_income_pre <- household$avg_household_income_pre
hist(avg_household_income_pre)
avg_household_income_post <- household$avg_household_income_post
hist(avg_household_income_post)
t.test(avg_household_income_pre, avg_household_income_post,  
       paired = TRUE, alternative = "two.sided")

```

#### Question 5-b: For businesses or shop owners only: Since connection to Renewvia mini-grid, have you seen any change in your weekly or monthly earnings?

**Data set**: Commercial Post Survey

**Statistical Test**: Pearson's Chi-squared test

**Hypothesis Testing**: $H_{0}$: No change in earnings for business owners; $H_{1}$: A change in earnings for business owners

```{r}
# Breakdown of observed change
PieChart(earnings_change, hole = 0, values = "%", 
         data = ci_post_clean,
         main = "")


earnings_change <- factor(ci_post_enc$earnings_change)
earnings_change_table <-table(earnings_change)
chisq.test(earnings_change_table,p=rep(1/3,3))
```

**TO-DO**

-   Has your household income changed since your connection to minigrid power?

-   What services are you able to offer/sell/provide due to connection to Renewvia minigrid that you weren't able to offer prior to connection?

-   What is the Clinic / Hospital able to offer or provide due to connection to Renewvia minigrid that it wasn't able to offer before?

-   What is your school able to offer / accomplish by having electricity that wasn't possible before?

-   Are any household members business owners?

-   Is this business recent (started after connection to mini-grid power?)

-   If this business is new, do you consider this new business a result of having access to mini-grid power?

-   Does this business use mini-grid power?

-   Since connection to Renewvia minI-grid, have you had any change in number of workers/employees at your place of work?
