---
title: "Renewvia - Survey Impact Analysis"
output:
  pdf_document: default
  html_document:
    df_print: paged
---

# Importing libraries

```{r}
library(ggplot2)
library(dplyr)
library(lessR)
library(tidyr)
library(ggpubr)
library(exact2x2)
library(stringr)
library(janitor)
library(epiDisplay)
```

# Loading the data

```{r}
## Locading the project data
projects <- read.csv("project_data.csv")
head(projects)
```

```{r}
## Locading the cleaned data sets
# Intial Survey
initial_clean <- read.csv("data_cleaning/datasets_clean/initial_clean.csv")%>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter")

# Pre-connection
intial_hs_pre <- initial_clean %>%
                    filter(status == "pre_connection")%>%
                    filter(tariff == "residential")

# Pre-connection
intial_hs_post <- initial_clean %>%
                    filter(status == "post_connection")%>%
                    filter(tariff == "residential")

head(initial_clean)
head(intial_hs_pre)
head(intial_hs_post)

# Household Post-Survey
post_clean <- read.csv("data_cleaning/datasets_clean/hs_post_clean.csv")%>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter")
# Post-Connection
post_hs <- post_clean %>% filter(tariff == "residential")
head(post_clean)
head(post_hs)

# Commercial & Insitution Post-Survey
ci_clean <- read.csv("data_cleaning/datasets_clean/ci_post_clean.csv") %>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter") %>% 
                    filter(tariff == "commercial")
head(ci_clean)
```

```{r}
## Locading the encoded data sets
# Intial Survey
initial_enc <- read.csv("data_cleaning/datasets_encoded/initial_encoded.csv")%>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter")

# Pre-connection
intial_hs_pre_enc <- initial_enc %>%
                    filter(status == 1)%>%
                    filter(tariff == "residential")

# Pre-connection
intial_hs_post_enc <- initial_enc %>%
                    filter(status == 2)%>%
                    filter(tariff == "residential")

head(initial_enc)
head(intial_hs_pre_enc)
head(intial_hs_post_enc)

# Household Post-Survey
post_enc <- read.csv("data_cleaning/datasets_encoded/hs_post_encoded.csv")%>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter")
# Post-Connection
post_hs_enc <- post_enc %>% filter(tariff == "residential")
head(post_enc)
head(post_hs_enc)

# Commercial & Insitution Post-Survey
ci_enc <- read.csv("data_cleaning/datasets_encoded/ci_post_encoded.csv") %>%
                    filter(renewvia_id != "") %>%
                    filter(renewvia_id != "no_meter") %>% 
                    filter(tariff == "commercial")
head(ci_enc)
```

# Pairing Household data

```{r}
paired_clean <- merge(intial_hs_pre, post_hs,
                      suffix = c("_pre", "_post"),
                      by= 'renewvia_id')
head(paired_clean)

paired_enc <- merge(intial_hs_pre_enc, post_hs_enc,
                      suffix = c("_pre", "_post"),
                      by= 'renewvia_id')
head(paired_enc)
```

# HYPOTHESIS TESTING

**Strategy**:

-   For the paired data set, we will use the Paired t-Test, Wilcoxon Signed Rank Test, Sign Test, and McNemar's Test whenever applicable

-   Our independent variables will be the following: PV Size (kWh), No. of Customers, CAPEX (USD) and Consumption (Community & Customer).

-   For each dependent variables, we will run a uni-variate regression tests with each of independent variable. When applicable, we will have a Linear regression t-Test or Logistic regression Wald test

## 1- GENDER EQUALITY

**Question**: Has there been a change in the number of females in your household who attend school full time since connection to mini-grid power?

**Data Source**: Household Post-Survey

**Value (Encoding if applied)**: "Yes, it's increased" = 1 "Yes, it's decreased" = -1, "No, it's the same" = 0

**Hypothesis Testing:**

${H_0}$ = No relationship between and increase in girls enrollment

${H_1}$ = ndefined PV Size (kwH) and increase in girls enrollment

```{r}
# Breakdown by response type
hs_post_clean <- post_clean %>% filter(tariff == "residential")
hs_post_enc <- post_enc %>% filter(tariff == "residential")
head(hs_post_clean)
head(hs_post_enc)
```

```{r}
var <- hs_post_clean$girls_schooling_change
girls_enrollment <- var[var != ""]

tab1(girls_enrollment, 
     sort.group = "decreasing", cum.percent = TRUE)

# Breakdown by response type and Community
girls_enrollment <- rownames_to_column(as.data.frame.matrix(
                                      prop.table(table(
                                          hs_post_clean$community, 
                                          hs_post_clean$girls_schooling_change),
                                         margin = 1)
                                                  )
                                      , var = "community")
community_girls_enrollment <- merge(x=projects, y=girls_enrollment, by="community")
community_girls_enrollment
```

```{r}
### Linear Regression t-Test

## PV Size (kwH)

# Visualizing the relationship with reported increase
df <- community_girls_enrollment 
              # %>% filter(community != "kalobeyei_settlement")
pv_size_scatter <- ggplot(df, 
                    aes(pv_size_kwh, yes_its_increased)) + 
                    geom_point() + 
                    theme_classic()
ggMarginal(pv_size_scatter, type = "histogram")

# Fitting the model with reported increase
pv_size_lm <- lm(yes_its_increased ~ pv_size_kwh, data=df)
summary(pv_size_lm)

# Visualizing the relationship with reported decrease
pv_size_scatter <- ggplot(df, 
                    aes(pv_size_kwh, yes_its_decreased)) + 
                    geom_point() + 
                    theme_classic()
ggMarginal(pv_size_scatter, type = "histogram")

# Fitting the model with reported decrease
pv_size_lm <- lm(yes_its_decreased ~ pv_size_kwh, data=df)
summary(pv_size_lm)
```

## TODO

```{r}
### Linear Regression t-Test
diff <- paired_enc$water_collection_time_post -   paired_enc$water_collection_time_pre
hist(diff)
# wilcox.test(immer$Y1, immer$Y2, paired=TRUE) 
```

-   How long does the water collection process take on a daily basis?

-   How long does the cooking fuel collection process take on a daily basis?

-   If you answered yes to adding new workers, how many new employees are female?

-   Are any household members business owners?

## 2- PRODUCTIVITY

## TODO

-   How many hours of light per day do you currently have at home?

-   Since connection to Renewvia mini-grid, have your hours of operation changed at all?

-   Has school performance changed since connection to mini-grid?

-   Have you seen a change in overall school performance?

## 3- HEALTH

## TODO

-   For clinics or health services only: Since connection to Renewvia mini-grid, have your health service offerings changed in any of the following ways: (select all that apply).

-   Does your Health Center have access to electricity?

-   Does your Health Center / Clinic have access to refrigeration?

-   Do you feel that you have better access to health services because of connection to mini-grid?

-   Do you have a source for clean drinking water?

-   Since connection to Renewvia mini-grid, has your access to clean drinking water changed at all?

-   How many kerosene lamps do you currently use in your household?

-   Has the number of kerosene lamps in your household changed since connection to mini-grid

## 4- SAFETY

## TODO

-   How safe do you feel outside your home when it is dark?

-   What makes you feel the most unsafe?

-   Does your community currently have outdoor community lights?

-   How safe would you feel outside your home at nighttime IF you had exterior lights?

## 5- ECONOMIC ACTIVITY

## TODO

-   What is your average monthly household income:

-   Has your household income changed since your connection to mini-grid power?

-   For businesses or shop owners only: Since connection to Renewvia mini-grid, have you seen any change in your weekly or monthly earnings?

-   Are any household members business owners?

-   Since connection to Renewvia mini-grid, have you had any change in number of workers/employees at your place of work?
